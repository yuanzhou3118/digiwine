<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="Description" content="">
    <meta name="format-detection" content="telephone=no">
    <title>葡萄酒微课堂</title>
    <link rel="stylesheet" href="css/global.css" type="text/css"/>
    <link rel="stylesheet" href="css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="css/main2.css" rel="stylesheet">
    <script type="text/javascript" src="js/plugin/jquery-1.11.1.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script type="text/javascript" src="js/template.js"></script>
    <script type="text/javascript" src="js/plugin/mustache.min.js"></script>
    <script type="text/javascript" src="js/request.js"></script>
    <script type="text/javascript" src="js/common.js"></script>
    <script type="text/javascript" src="js/loading.js"></script>
    <script type="text/javascript" src="js/enter.js"></script>
    <script type="text/javascript" src="js/plugin/velocity.min.js"></script>
    <script type="text/javascript" src="js/plugin/createjs.js"></script>
    <script type="text/javascript" src="js/plugin/exif.js"></script>
    <script type="text/javascript" src="js/plugin/hammer.min.js"></script>
    <script type="text/javascript" src="js/plugin/binaryajax.js"></script>
    <script type="text/javascript" src="js/plugin/megapix-image.js"></script>
    <script type="text/javascript">
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                        (i[r].q = i[r].q || []).push(arguments)
                    }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-25338682-20', 'auto');
        ga('send', 'pageview');

        $(function () {
            var arr = [];
            var percent = $('.loading').find('.percent-num');
            preloadimages(arr, percent);
        });
    </script>
    <!-- Acxiom AbiliTag v2.0 for site: PRC009 -->
    <script type="text/javascript">window.acxm = {
        api: Function(), x: function () {
            var k = document, e = encodeURIComponent, r = "script", m = k.getElementsByTagName(r)[0], i = k.createElement(r), t = "&c=";
            try {
                t = t + k.cookie.match('_acxm=([^;]*)').slice(1);
            } catch (z) {
            }
            ;
            i.async = true;
            i.src = "//t-cn.acxiom-online.com/tag/5d4f3a6a3ef951e3c72b135e8e01c2ba/st.js?l=" + e(k.location) + "&r=" + e(k.referrer) + t + "&v=2.0&z=" + Math.random();
            m.parentNode.insertBefore(i, m)
        }()
    }</script>
    <script type="text/javascript">
        (function () {
            window._CiQ11462 = window._CiQ11462 || [];
            window._CiQ11462.push(['_cookieUseRootDomain', true]);
            var c = document.createElement('script');
            c.type = 'text/javascript';
            c.async = true;
            c.charset = 'utf-8';
            c.src = '//collect.cn.miaozhen.com/ca/11462';
            var h = document.getElementsByTagName('script')[0];
            h.parentNode.insertBefore(c, h);
        })();
    </script>

</head>
<body class="main-wrap">
<div class="modal-orientation" id="orientation">
    <img src="images/flip.jpg"/>
</div>
<div class="red-nav red-bg">
    <div class="nav-bar-closeIcon fl"></div>
    <div class="nav-bar-rightIcon fr" data-ga="45"></div>
</div>
<div id="modifyUserData" class="margin-top-100">
    <div class="avator-area white-bg">
        <div class="avator">
            <img src="img2/userInfo/default-avator.png"/>
            <b class="avator-flag"></b>
            <input type="file" id="updateUserAvator" class="takepicture" target="0" accept="image/*" capture="camera">
        </div>
        <div class="avator-tips">点击修改头像</div>
    </div>
    <ul class="user-info white-bg">
        <li id="nickName">
            <label class="user-info-label fl">昵称</label>
            <input class="user-info-content fl" type="text" value="" maxlength="100" placeholder="请填写昵称(必填)"/>
            <div class="form-error red hidden">请填写昵称(必填)</div>
        </li>
        <li id="bindMobile">
            <label class="user-info-label fl">绑定手机</label>
            <div class="user-info-content fl" style="pointer-events: none;">未绑定</div>
            <span class="right-icon"></span>
        </li>
        <li id="weChat">
            <label class="user-info-label fl">微信号</label>
            <div class="user-info-content fl">未绑定</div>
        </li>
    </ul>
    <ul class="user-info white-bg">
        <li id="sex">
            <label class="user-info-label fl">性别</label>
            <div class="user-info-content fl">
                <div class="sex-select" gender="0"><b class="check-icon fl"></b><span class="fl">男</span></div>
                <div class="sex-select" gender="1"><b class="check-icon fl"></b><span class="fl">女</span></div>
            </div>
            <div class="gender-error form-error red hidden">请选择您的性别(必选)</div>
        </li>
        <li id="area">
            <label class="user-info-label fl">地区</label>
            <input class="user-info-content fl" type="text" maxlength="20" placeholder="请填写您所在的地区(必填)"/>
            <div class="form-error red hidden">请填写您所在的地区(必填)</div>
        </li>
        <li id="birthday">
            <label class="user-info-label fl">生日</label>
            <input class="user-info-content fl" type="date" placeholder="请填写您的生日(必填)"/>
            <div class="form-error red hidden">请填写您的生日(必填)</div>
        </li>
    </ul>
    <ul class="user-info white-bg">
        <li id="interest">
            <label class="user-info-label fl">兴趣</label>
            <input class="user-info-content fl" type="text" maxlength="200" placeholder="请填写您的兴趣(必填)"/>
            <div class="form-error red hidden">请填写您的兴趣(必填)</div>
        </li>
        <li id="profession">
            <label class="user-info-label fl">职业</label>
            <input class="user-info-content fl" type="text" maxlength="100" placeholder="请填写您的职业(必填)"/>
            <div class="form-error red hidden">请填写您的职业(必填)</div>
        </li>

    </ul>
</div>

<div id="kv-pop" class="pop-wrap hidden">
    <img src="images/other/qr-code.jpg" style="padding-top:200px;padding-left:170px;">
    <div class="qr-code-wrap" style="position: relative;float:left;">
        长按二维码，关注杰卡斯官方微信<br>
        及时获取最新资讯
    </div>
</div>
</body>
<script type="text/javascript">
//    toLogin();
    $().ready(function () {
        function back() {
            location.href = "account.html";
        }

        //返回
        $(".nav-bar-closeIcon").click(function () {
            back();
        })
        //保存修改
        var profile_updateFlag = false
        $(".nav-bar-rightIcon").click(function () {
            if(profile_updateFlag){
                return;
            }

            var nickName = $nickName.val(),
                    area = $area.val(),
                    interest = $interest.val(),
                    profession = $profession.val(),
                    birthday = $birthday.val(),
                    gender = $(".sex-select.checked-icon").attr("gender");

            var error = false;
            if(!nickName){
                error = true;
                $("#nickName .form-error").removeClass("hidden");
            }else{
                $("#nickName .form-error").addClass("hidden");
            }
            if(!area){
                error = true;
                $("#area .form-error").removeClass("hidden");
            }else{
                $("#area .form-error").addClass("hidden");
            }
            if(!interest){
                error = true;
                $("#interest .form-error").removeClass("hidden");
            }else{
                $("#interest .form-error").addClass("hidden");
            }
            if(!birthday){
                error = true;
                $("#birthday .form-error").removeClass("hidden");
            }else{
                $("#birthday .form-error").addClass("hidden");
            }
            if(!gender){
                error = true;
                $(".gender-error").removeClass("hidden");
            }else{
                $(".gender-error").addClass("hidden");
            }
            if(!profession){
                error = true;
                $("#profession .form-error").removeClass("hidden");
            }else{
                $("#profession .form-error").addClass("hidden");
            }
            if(error){
                alert("请填写完整您的基本信息");
                return
            }
            profile_updateFlag = true;
            Request.profile_update(function (data) {
                if (data.result == 1) {
                    alert("信息更新成功");
                    location.href="account.html";
                } else if (data.result == 0) {
                    alert("更新个人基本信息失败");
                } else if (data.result == -1) {
                    alert("参数不合法");
                }
                profile_updateFlag =false;
            }, nickName, area, interest, profession, parseInt(gender), birthday);

        })

        //点击修改头像
        readyToUploadImg(function (data) {
            $(".avator img").attr("src", data);
            Request.profile_head(function (data) {
                console.log("头像更换成功");
            }, data);
        }, 300, 300);

        if (User && User.avatarurl) {
            $(".avator img").attr("src", User.avatarurl);
        }

        //获取个人信息
        var $nickName = $("#nickName input"), $mobile = $("#bindMobile .user-info-content"), $weChat = $("#weChat .user-info-content"),
                $bindMobile = $("#bindMobile"),
                $bindWeChat = $("#weChat"),
                $sexs = $("#sex .sex-select"), $man = $("#sex .sex-select").eq(0), $woman = $("#sex .sex-select").eq(1);
        $area = $("#area input")
        $birthday = $("#birthday input"),
                $interest = $("#interest input") ,
                $profession = $("#profession input");

        $sexs.click(function () {
            $sexs.removeClass("checked-icon");
            $(this).addClass("checked-icon");
        })

        $bindMobile.click(function () {
            if (!$(this).hasClass("binded")) {
                location.href = "phoneBind.html";
            }
        })
        $bindWeChat.click(function () {
            if (!$(this).hasClass("binded")) {
                if (isWechat()) {
                    Request.wechat_redirect(RedirectVhost + "/modifyUserData.html?status=bind");
                } else {
                    alert("请在微信环境中打开")
                }
            }
        })


        Request.profile_detail(function (resultData) {
            resultData = resultData.data;
            resultData.nick_name && $nickName.val(decodeURIComponent(resultData.nick_name));
            if (resultData.binding_mobile_status && resultData.mobile) {
                $mobile.html(resultData.mobile || "已绑定");
                $bindMobile.addClass("binded");
            }
            if (resultData.binding_wechat_status) {
                $weChat.html("已绑定");
                $bindWeChat.addClass("binded")
            }
            if (resultData.gender) {
                if (resultData.gender == 0) {
                    $man.addClass("checked-icon")
                } else {
                    $woman.addClass("checked-icon");
                }
            }
            resultData.area && $area.val(resultData.area);
            resultData.birthday && $birthday.val(resultData.birthday);
            if (resultData.interest) {
                $interest.val(resultData.interest);
            }
            if (resultData.profession) {
                $profession.val(resultData.profession);
            }
        })
    });
</script>
<script type="text/javascript" src="js/tracking.js"></script>
</html>